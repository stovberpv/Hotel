<?php 
    #---------------------------------------------------------------------------------
    # debug settings
    #---------------------------------------------------------------------------------
    if (true) {
        ini_set('display_errors', 1);
        ini_set('display_startup_errors', 1);
        error_reporting(E_ALL);
    }
    #---------------------------------------------------------------------------------
    # connect to db
    #---------------------------------------------------------------------------------
    require $_SERVER['DOCUMENT_ROOT'] . '/utils.php';
    #---------------------------------------------------------------------------------
    # 
    #---------------------------------------------------------------------------------
    $isNew = true;
    #---------------------------------------------------------------------------------
    # 
    #---------------------------------------------------------------------------------
    $data['1. tel'] = $tel;
    if ($tel) {
        $tel = preg_replace('~\D+~', '', $tel);
        $data['2. tel'] = $tel;
        #---------------------------------------------------------------------------------
        # 
        #---------------------------------------------------------------------------------
        $query = 'SELECT * FROM pb001 WHERE tel = ?';
        #
        !($stmt = $mysqli->prepare($query));
        !($stmt->bind_param('s', $tel));
        !($stmt->execute());
        !($result = $stmt->get_result());
        #
        $rows = []; 
        while($row = $result->fetch_assoc()) {
            $rows[] = $row;
        }
        #
        $stmt->free_result();
        $stmt->close();
        #---------------------------------------------------------------------------------
        # 
        #---------------------------------------------------------------------------------
        foreach ($rows as $key => $val) {
            $val['tel'] == $tel && $val['name'] == $name && $isNew = false;
        }
    }
    #---------------------------------------------------------------------------------
    # 
    #---------------------------------------------------------------------------------
    if ($isNew) {
        $data['3. name'] = $name;
        $query = "INSERT INTO pb001 (name, tel, city, info) VALUES (?, ?, ?, ?)";
        #
        !($stmt = $mysqli->prepare($query)) && $data['err: prepare'] = $stmt->error;
        !($stmt->bind_param('siss', $name, $tel, $city, $fn)) && $data['err: bind_param'] = $stmt->error;
        !($stmt->execute()) && $data['err: execute'] = $stmt->error;
        #
        $stmt->close();
    } 
    #---------------------------------------------------------------------------------
    # 
    #---------------------------------------------------------------------------------
    $mysqli->close();
    #
    $data['isNew'] = $isNew; 
?>